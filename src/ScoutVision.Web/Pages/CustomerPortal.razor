@page "/portal"
@using System.Net.Http.Json
@inject HttpClient Http
@using MudBlazor

<PageTitle>Customer Portal</PageTitle>

<MudPaper Class="pa-6" Elevation="2">
    <MudText Typo="Typo.h4" Class="mb-4">Your Billing Portal</MudText>
    <MudText Typo="Typo.body1" Class="mb-2">View your invoices, payment history, and manage your subscription.</MudText>
    <MudTable Items="@Invoices">
        <HeaderContent>
            <MudTh>Invoice #</MudTh>
            <MudTh>Amount</MudTh>
            <MudTh>Date</MudTh>
            <MudTh>Status</MudTh>
        </HeaderContent>
        <RowTemplate>
            <MudTd>@context.InvoiceId</MudTd>
            <MudTd>@context.Amount.ToString("C")</MudTd>
            <MudTd>@context.InvoiceDate.ToShortDateString()</MudTd>
            <MudTd>@context.Status</MudTd>
        </RowTemplate>
    </MudTable>
    <MudDivider Class="my-4" />
    <MudText Typo="Typo.h6">Subscription Management</MudText>
    <MudButton Variant="Variant.Filled" Color="Color.Primary" OnClick="UpgradeSubscription">Upgrade</MudButton>
    <MudButton Variant="Variant.Outlined" Color="Color.Error" OnClick="CancelSubscription">Cancel</MudButton>
</MudPaper>

@code {
    public List<Invoice> Invoices { get; set; } = new();
    public class Invoice
    {
        public string InvoiceId { get; set; } = string.Empty;
        public decimal Amount { get; set; }
        public DateTime InvoiceDate { get; set; }
        public string Status { get; set; } = "Paid";
    }
    protected override async Task OnInitializedAsync()
    {
        // TODO: Replace with API call to fetch invoices
        Invoices = new List<Invoice>
        {
            new Invoice { InvoiceId = "INV-1001", Amount = 200, InvoiceDate = DateTime.UtcNow.AddDays(-30), Status = "Paid" },
            new Invoice { InvoiceId = "INV-1002", Amount = 200, InvoiceDate = DateTime.UtcNow.AddDays(-1), Status = "Due" }
        };
    }
    private void UpgradeSubscription() { /* TODO: Implement upgrade logic */ }
    private void CancelSubscription() { /* TODO: Implement cancel logic */ }
}
